<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>T√≠nh ti·ªÅn thi c√¥ng ‚Äî Pro Light UI</title>

  <style>
    :root{
      --bg0:#f6f8ff;
      --bg1:#eef2ff;
      --card: rgba(255,255,255,.78);
      --card2: rgba(255,255,255,.62);
      --stroke: rgba(15,23,42,.10);
      --text:#0f172a;
      --muted: rgba(15,23,42,.62);

      --a:#2563eb; /* blue */
      --b:#7c3aed; /* violet */
      --c:#10b981; /* green */
      --w:#f59e0b; /* amber */
      --r:#ef4444; /* red */

      --shadow: 0 18px 50px rgba(15,23,42,.10);
      --shadow2: 0 10px 28px rgba(15,23,42,.10);

      --radius: 18px;
      --radius2: 22px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;

      --headerH: 74px;
      --sidebarW: 330px;
      --max: 1220px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(900px 520px at 12% 18%, rgba(37,99,235,.18), transparent 62%),
        radial-gradient(900px 520px at 88% 22%, rgba(124,58,237,.16), transparent 62%),
        radial-gradient(900px 520px at 50% 95%, rgba(16,185,129,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* ===== animated blobs ===== */
    .blobs{
      position: fixed; inset: -18vh -10vw;
      pointer-events:none;
      z-index: 0;
      background:
        radial-gradient(closest-side at 18% 20%, rgba(37,99,235,.14), transparent 62%),
        radial-gradient(closest-side at 82% 26%, rgba(124,58,237,.12), transparent 62%),
        radial-gradient(closest-side at 55% 80%, rgba(16,185,129,.10), transparent 62%);
      filter: blur(28px);
      opacity: .95;
      animation: floaty 16s ease-in-out infinite alternate;
    }
    @@keyframes floaty{
      from{ transform: translate(-1.2%,-1.0%) scale(1.02); }
      to  { transform: translate(1.2%, 1.0%) scale(1.06); }
    }

    /* ===== subtle grid texture ===== */
    .texture{
      position: fixed; inset:0;
      pointer-events:none;
      z-index: 0;
      opacity: .25;
      background-image:
        linear-gradient(to right, rgba(15,23,42,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(15,23,42,.06) 1px, transparent 1px);
      background-size: 44px 44px;
      mask-image: radial-gradient(closest-side at 50% 40%, rgba(0,0,0,1), transparent 72%);
    }

    /* ===== App layout ===== */
    .app{
      position: relative;
      z-index: 1;
      min-height: 100vh;
      display:grid;
      grid-template-rows: var(--headerH) 1fr;
      grid-template-columns: var(--sidebarW) 1fr;
      grid-template-areas:
        "header header"
        "sidebar main";
    }

    /* ===== Header ===== */
    header{
      grid-area: header;
      position: sticky;
      top:0;
      z-index: 20;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 14px;
      background: rgba(255,255,255,.65);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--stroke);
    }

    .h-left{
      display:flex; align-items:center; gap: 10px;
      min-width: 0;
    }

    .hamburger{
      display:none;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.75);
      box-shadow: var(--shadow2);
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
    }

    .logo{
      width: 44px; height: 44px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(37,99,235,.95), rgba(124,58,237,.95));
      box-shadow: 0 14px 34px rgba(37,99,235,.18);
      position: relative;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.75);
      flex: 0 0 auto;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-60%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.60), transparent);
      transform: rotate(25deg);
      animation: shine 2.8s ease-in-out infinite;
      opacity:.6;
    }
    @@keyframes shine{
      0%{ transform: translateX(-35%) rotate(25deg); opacity: 0; }
      28%{ opacity: .75; }
      100%{ transform: translateX(35%) rotate(25deg); opacity: 0; }
    }

    .h-title{ min-width:0; display:flex; flex-direction:column; gap:2px; }
    .h-title b{
      font-size: 14px;
      letter-spacing:.2px;
      white-space: nowrap; overflow:hidden; text-overflow: ellipsis;
    }
    .h-title span{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap; overflow:hidden; text-overflow: ellipsis;
      max-width: 56vw;
    }

    .h-right{
      display:flex; align-items:center; gap:10px; flex-wrap: wrap; justify-content:flex-end;
    }

    .pill{
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow2);
      color: rgba(15,23,42,.78);
      display:inline-flex; gap:8px; align-items:center;
      user-select:none;
    }
    .dot{
      width: 8px; height: 8px; border-radius: 99px;
      background: rgba(16,185,129,.95);
      box-shadow: 0 0 14px rgba(16,185,129,.20);
    }

    .btn{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.75);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor: pointer;
      font-size: 14px;
      transition: transform .10s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
      display:inline-flex; align-items:center; gap:8px;
      box-shadow: var(--shadow2);
      user-select:none;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.92);
      border-color: rgba(37,99,235,.22);
      box-shadow: 0 16px 40px rgba(15,23,42,.12);
    }
    .btn.primary{
      background: rgba(37,99,235,.10);
      border-color: rgba(37,99,235,.22);
    }
    .btn.primary:hover{
      background: rgba(37,99,235,.14);
    }

    .search{
      display:flex; align-items:center; gap:10px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.75);
      border-radius: 16px;
      padding: 10px 12px;
      box-shadow: var(--shadow2);
      min-width: min(42vw, 520px);
      position: relative;
      overflow:hidden;
    }
    .search::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(700px 180px at 20% 0%, rgba(37,99,235,.12), transparent 62%),
        radial-gradient(700px 180px at 90% 40%, rgba(124,58,237,.10), transparent 66%);
      filter: blur(18px);
      opacity: .9;
      pointer-events:none;
    }
    .search input{
      position:relative; z-index:2;
      width:100%;
      border:0; outline:none;
      background: transparent;
      color: var(--text);
      font-size: 14px;
    }

    /* ===== Sidebar ===== */
    aside{
      grid-area: sidebar;
      position: sticky;
      top: var(--headerH);
      height: calc(100vh - var(--headerH));
      overflow:auto;
      padding: 12px;
      border-right: 1px solid var(--stroke);
      background: rgba(255,255,255,.35);
      backdrop-filter: blur(14px);
    }

    .card{
      border: 1px solid var(--stroke);
      background: var(--card);
      border-radius: var(--radius2);
      box-shadow: var(--shadow2);
      padding: 14px;
      margin-bottom: 12px;
      position: relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(700px 160px at 20% 0%, rgba(37,99,235,.10), transparent 62%),
        radial-gradient(700px 160px at 90% 35%, rgba(124,58,237,.08), transparent 66%);
      filter: blur(18px);
      opacity: .7;
      pointer-events:none;
    }
    .card > *{ position: relative; z-index: 2; }

    .cardHead{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom: 10px;
    }
    .cardHead b{ font-size: 13px; letter-spacing:.2px; }
    .cardHead small{ color: var(--muted); }

    .kv{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .kvRow{
      display:flex; align-items:flex-start; justify-content: space-between; gap: 10px;
      padding: 10px 12px;
      border: 1px solid rgba(15,23,42,.08);
      background: rgba(255,255,255,.65);
      border-radius: 16px;
    }
    .kvRow span{ color: var(--muted); font-size: 12px; }
    .kvRow b{ font-size: 13px; max-width: 60%; text-align:right; }

    .progressWrap{ display:flex; align-items:center; gap: 10px; }
    .bar{
      flex: 1;
      height: 10px;
      border-radius: 999px;
      background: rgba(15,23,42,.08);
      overflow:hidden;
      border: 1px solid rgba(15,23,42,.06);
    }
    .bar > i{
      display:block; height:100%;
      width: 55%;
      background: linear-gradient(90deg, rgba(37,99,235,.85), rgba(124,58,237,.75));
      border-radius: 999px;
      animation: loadBar 1.1s ease-out;
    }
    @@keyframes loadBar{
      from{ width: 10%; opacity:.4; }
      to{ width: 55%; opacity:1; }
    }

    .quick{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .qbtn{
      border: 1px solid rgba(15,23,42,.08);
      background: rgba(255,255,255,.70);
      border-radius: 16px;
      padding: 12px;
      cursor:pointer;
      box-shadow: var(--shadow2);
      transition: transform .10s ease, box-shadow .12s ease, border-color .12s ease, background .12s ease;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .qbtn:hover{
      transform: translateY(-1px);
      border-color: rgba(37,99,235,.20);
      background: rgba(255,255,255,.92);
      box-shadow: 0 16px 40px rgba(15,23,42,.12);
    }
    .qbtn b{ font-size: 13px; }
    .qbtn span{ color: var(--muted); font-size: 12px; }

    /* ===== Main ===== */
    main{
      grid-area: main;
      padding: 16px;
    }
    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      display:flex;
      flex-direction: column;
      gap: 14px;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 14px;
      align-items:start;
    }

    .panel{
      border: 1px solid var(--stroke);
      background: var(--card);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
      position: relative;
    }
    .panel::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(900px 240px at 20% 0%, rgba(37,99,235,.10), transparent 62%),
        radial-gradient(900px 240px at 80% 0%, rgba(124,58,237,.08), transparent 66%);
      filter: blur(18px);
      opacity: .8;
      pointer-events:none;
    }
    .panelInner{
      position: relative;
      padding: 16px;
      display:flex;
      flex-direction: column;
      gap: 12px;
    }

    .panelHead{
      display:flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    .panelHead .left b{ font-size: 15px; letter-spacing:.2px; }
    .panelHead .left div{ margin-top: 4px; font-size: 13px; color: var(--muted); }

    /* ===== Input form ===== */
    .formGrid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
    }
    .field{
      grid-column: span 6;
      display:flex;
      flex-direction: column;
      gap: 6px;
    }
    .field label{
      font-size: 12px;
      color: var(--muted);
    }
    .field input, .field select{
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.78);
      border-radius: 14px;
      padding: 12px 12px;
      font-size: 14px;
      outline:none;
      box-shadow: var(--shadow2);
      transition: border-color .12s ease, background .12s ease;
    }
    .field input:focus, .field select:focus{
      border-color: rgba(37,99,235,.25);
      background: rgba(255,255,255,.92);
    }
    .field.wide{ grid-column: span 12; }
    .field.third{ grid-column: span 4; }
    @media (max-width: 980px){
      .field{ grid-column: span 12; }
      .field.third{ grid-column: span 12; }
    }

    .rowActions{
      display:flex; gap: 10px; flex-wrap: wrap; align-items:center;
    }

    /* ===== Table ===== */
    .tableWrap{
      overflow:auto;
      border-radius: 18px;
      border: 1px solid rgba(15,23,42,.08);
      background: rgba(255,255,255,.62);
      box-shadow: var(--shadow2);
    }
    table{
      width:100%;
      border-collapse: collapse;
      min-width: 980px;
    }
    thead th{
      position: sticky;
      top: 0;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      font-size: 12px;
      color: rgba(15,23,42,.72);
      text-align:left;
      padding: 12px 12px;
      border-bottom: 1px solid rgba(15,23,42,.08);
      white-space: nowrap;
    }
    tbody td{
      padding: 12px 12px;
      border-bottom: 1px solid rgba(15,23,42,.06);
      font-size: 13px;
      white-space: nowrap;
    }
    tbody tr{
      transition: background .12s ease, transform .10s ease;
    }
    tbody tr:hover{
      background: rgba(37,99,235,.06);
    }
    .money{ font-weight: 800; }
    .tag{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(15,23,42,.08);
      background: rgba(255,255,255,.80);
      color: rgba(15,23,42,.78);
      display:inline-flex; gap:6px; align-items:center;
    }
    .tag i{
      width:7px; height:7px; border-radius: 99px;
      display:inline-block;
      background: rgba(37,99,235,.85);
    }

    .iconBtn{
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.72);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      box-shadow: var(--shadow2);
      transition: transform .10s ease, background .12s ease;
    }
    .iconBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.92); }

    /* ===== Summary cards ===== */
    .sumGrid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
    }
    .sumCard{
      grid-column: span 6;
      border: 1px solid rgba(15,23,42,.08);
      background: rgba(255,255,255,.70);
      border-radius: 18px;
      box-shadow: var(--shadow2);
      padding: 14px;
      position: relative;
      overflow:hidden;
      transition: transform .10s ease, box-shadow .12s ease, border-color .12s ease;
    }
    .sumCard:hover{
      transform: translateY(-1px);
      border-color: rgba(37,99,235,.20);
      box-shadow: 0 16px 44px rgba(15,23,42,.12);
    }
    .sumCard::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(700px 180px at 20% 0%, rgba(37,99,235,.12), transparent 62%),
        radial-gradient(700px 180px at 90% 40%, rgba(124,58,237,.10), transparent 66%);
      filter: blur(18px);
      opacity: .45;
      pointer-events:none;
    }
    .sumCard > *{ position:relative; z-index:2; }
    .sumTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .sumTop b{ font-size: 13px; color: rgba(15,23,42,.78); }
    .sumVal{
      margin-top: 8px;
      font-size: 22px;
      font-weight: 900;
      letter-spacing:.2px;
    }
    .sumSub{
      margin-top: 6px;
      color: var(--muted);
      font-size: 12px;
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .sumCard.full{ grid-column: span 12; }

    @@media (max-width: 980px){
      .grid2{ grid-template-columns: 1fr; }
      .sumCard{ grid-column: span 12; }
      table{ min-width: 880px; }
      .search{ min-width: min(70vw, 520px); }
    }

    /* ===== Timeline ===== */
    .timeline{
      display:flex;
      flex-direction: column;
      gap: 10px;
    }
    .step{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid rgba(15,23,42,.08);
      background: rgba(255,255,255,.70);
      box-shadow: var(--shadow2);
      transition: transform .10s ease, border-color .12s ease;
    }
    .step:hover{
      transform: translateY(-1px);
      border-color: rgba(124,58,237,.18);
    }
    .sDot{
      width: 12px; height: 12px;
      border-radius: 99px;
      background: rgba(37,99,235,.85);
      box-shadow: 0 0 14px rgba(37,99,235,.18);
      margin-top: 4px;
      flex:0 0 auto;
    }
    .sBody{ min-width:0; }
    .sBody b{ font-size: 13px; }
    .sBody p{
      margin: 4px 0 0 0;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }
    .meta{
      margin-top: 6px;
      display:flex; gap:8px; flex-wrap:wrap;
      color: rgba(15,23,42,.55);
      font-size: 11px;
    }

    /* ===== Toast ===== */
    .toast{
      position: fixed;
      right: 14px;
      bottom: 14px;
      z-index: 50;
      display:flex;
      flex-direction: column;
      gap: 10px;
      pointer-events:none;
    }
    .toastItem{
      pointer-events:auto;
      width: min(360px, 92vw);
      border-radius: 18px;
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.86);
      backdrop-filter: blur(12px);
      box-shadow: 0 22px 70px rgba(15,23,42,.18);
      padding: 12px 12px;
      display:flex;
      gap: 10px;
      align-items:flex-start;
      animation: pop .18s ease-out;
    }
    @@keyframes pop{
      from{ transform: translateY(8px); opacity: 0; }
      to{ transform: translateY(0); opacity: 1; }
    }
    .tDot{
      width: 12px; height: 12px; border-radius: 99px;
      background: rgba(16,185,129,.92);
      box-shadow: 0 0 14px rgba(16,185,129,.20);
      margin-top: 4px;
      flex:0 0 auto;
    }
    .tBody{ min-width:0; }
    .tBody b{ font-size: 13px; }
    .tBody p{ margin: 4px 0 0 0; font-size: 12px; color: var(--muted); line-height: 1.45; }
    .tX{
      margin-left:auto;
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.75);
      border-radius: 12px;
      cursor:pointer;
      padding: 6px 10px;
      font-size: 12px;
    }

    /* ===== mobile sidebar overlay ===== */
    .backdrop{
      display:none;
      position: fixed;
      inset: var(--headerH) 0 0 0;
      background: rgba(15,23,42,.18);
      z-index: 15;
    }
    @media (max-width: 980px){
      :root{ --sidebarW: 0px; }
      .app{
        grid-template-columns: 1fr;
        grid-template-areas:
          "header"
          "main";
      }
      aside{
        position: fixed;
        top: var(--headerH);
        left: 0;
        width: min(88vw, 360px);
        height: calc(100vh - var(--headerH));
        transform: translateX(-105%);
        transition: transform .18s ease;
        z-index: 30;
      }
      body.sidebar-open aside{ transform: translateX(0); }
      body.sidebar-open .backdrop{ display:block; }
      .hamburger{ display:inline-flex; }
    }

    @@media (prefers-reduced-motion: reduce){
      .blobs{ animation: none !important; }
      .btn, .qbtn, .sumCard, .step, tbody tr{ transition: none !important; }
    }

    /* ===== print ===== */
    @@media print{
      header, aside, .backdrop, .toast, .rowActions .btn:not(.printKeep){ display:none !important; }
      body{ background:#fff !important; }
      .panel, .card{ box-shadow:none !important; }
      table{ min-width: 0 !important; }
    }
  </style>
</head>

<body>
  <div class="blobs" aria-hidden="true"></div>
  <div class="texture" aria-hidden="true"></div>

  <div class="app">
    <header>
      <div class="h-left">
        <button class="hamburger" id="sidebarBtn" aria-label="M·ªü thanh b√™n">‚ò∞</button>
        <div class="logo" aria-hidden="true"></div>
        <div class="h-title">
          <b>T√≠nh ti·ªÅn thi c√¥ng ‚Äî B·∫£ng d·ª± to√°n & thanh to√°n</b>
          <span>UI s√°ng ‚Ä¢ nhi·ªÅu n·ªôi dung ‚Ä¢ hi·ªáu ·ª©ng ‚Äúƒë√£ m·∫Øt‚Äù ‚Ä¢ in/ xu·∫•t JSON</span>
        </div>
      </div>

      <div class="h-right">
        <div class="search" title="T√¨m theo h·∫°ng m·ª•c / ghi ch√∫">
          <span style="position:relative; z-index:2;">üîé</span>
          <input id="search" placeholder="T√¨m d√≤ng‚Ä¶ (VD: tr·∫ßn th·∫°ch cao, v√°ch, s∆°n, ƒëi·ªán‚Ä¶)" />
        </div>
        <span class="pill"><span class="dot"></span><span id="statusTxt">ƒêang t√≠nh realtime</span></span>
        <button class="btn primary" id="btnExport">üì¶ Export JSON</button>
        <button class="btn printKeep" id="btnPrint">üñ®Ô∏è In / PDF</button>
      </div>
    </header>

    <aside>
      <div class="card">
        <div class="cardHead">
          <b>Th√¥ng tin d·ª± √°n</b>
          <small id="today">--</small>
        </div>
        <div class="kv">
          <div class="kvRow"><span>D·ª± √°n</span><b id="pjName">Thi c√¥ng th·∫°ch cao ‚Ä¢ Nh√† ph·ªë</b></div>
          <div class="kvRow"><span>Kh√°ch h√†ng</span><b id="pjClient">Anh/Ch·ªã ‚Ä¶</b></div>
          <div class="kvRow"><span>ƒê·ªãa ch·ªâ</span><b id="pjAddr">TP.HCM</b></div>
          <div class="kvRow"><span>ƒê∆°n v·ªã</span><b>m¬≤ / md / b·ªô</b></div>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <b>Ti·∫øn ƒë·ªô</b>
          <small>Auto</small>
        </div>
        <div class="progressWrap">
          <div class="bar"><i id="barFill"></i></div>
          <b id="barPct">55%</b>
        </div>
        <div style="margin-top:10px; color:var(--muted); font-size:12px; line-height:1.45;">
          G·ª£i √Ω: chia l√†m 3 ƒë·ª£t thanh to√°n (t·∫°m ·ª©ng ‚Üí nghi·ªám thu ph·∫ßn ‚Üí b√†n giao).
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <b>Quick actions</b>
          <small>1-click</small>
        </div>
        <div class="quick">
          <div class="qbtn" id="btnDemo">
            <div>
              <b>Th√™m m·∫´u</b>
              <span>3 h·∫°ng m·ª•c</span>
            </div>
            <div>‚ú®</div>
          </div>
          <div class="qbtn" id="btnClear">
            <div>
              <b>X√≥a h·∫øt</b>
              <span>reset b·∫£ng</span>
            </div>
            <div>üßπ</div>
          </div>
          <div class="qbtn" id="btnVAT">
            <div>
              <b>VAT 8%</b>
              <span>b·∫≠t/t·∫Øt</span>
            </div>
            <div>üßæ</div>
          </div>
          <div class="qbtn" id="btnDeposit">
            <div>
              <b>T·∫°m ·ª©ng</b>
              <span>nh·∫≠p nhanh</span>
            </div>
            <div>üí∏</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <b>Ghi ch√∫</b>
          <small>ƒê√≠nh k√®m</small>
        </div>
        <textarea id="note" rows="4" style="width:100%; border-radius:16px; border:1px solid rgba(15,23,42,.10); background: rgba(255,255,255,.75); padding:12px; font-size:13px; outline:none; box-shadow:var(--shadow2);"
          placeholder="VD: ƒê∆°n gi√° ƒë√£ g·ªìm v·∫≠t t∆∞/nh√¢n c√¥ng? Th·ªùi gian thi c√¥ng? ƒêi·ªÅu kho·∫£n b·∫£o h√†nh..."></textarea>
      </div>
    </aside>

    <div class="backdrop" id="backdrop" aria-hidden="true"></div>

    <main>
      <div class="wrap">
        <section class="panel">
          <div class="panelInner">
            <div class="panelHead">
              <div class="left">
                <b>Nh·∫≠p h·∫°ng m·ª•c thi c√¥ng</b>
                <div>Th√™m d√≤ng ‚Üí b·∫£ng t·ª± t√≠nh ‚Üí t·ªïng h·ª£p & thanh to√°n.</div>
              </div>
              <div class="rowActions">
                <button class="btn primary" id="btnAdd">‚ûï Th√™m d√≤ng</button>
                <button class="btn" id="btnRecalc">üîÅ T√≠nh l·∫°i</button>
                <button class="btn" id="btnToast">‚ú® Test hi·ªáu ·ª©ng</button>
              </div>
            </div>

            <div class="formGrid">
              <div class="field">
                <label>H·∫°ng m·ª•c</label>
                <input id="fName" placeholder="VD: Tr·∫ßn th·∫°ch cao khung ch√¨m" />
              </div>

              <div class="field">
                <label>Nh√≥m</label>
                <select id="fGroup">
                  <option value="V·∫≠t t∆∞">V·∫≠t t∆∞</option>
                  <option value="Nh√¢n c√¥ng">Nh√¢n c√¥ng</option>
                  <option value="Thi·∫øt b·ªã">Thi·∫øt b·ªã</option>
                  <option value="Kh√°c">Kh√°c</option>
                </select>
              </div>

              <div class="field third">
                <label>Kh·ªëi l∆∞·ª£ng</label>
                <input id="fQty" type="number" min="0" step="0.01" value="10" />
              </div>

              <div class="field third">
                <label>ƒê∆°n gi√°</label>
                <input id="fPrice" type="number" min="0" step="1000" value="120000" />
              </div>

              <div class="field third">
                <label>H·ªá s·ªë</label>
                <input id="fCoef" type="number" min="0" step="0.01" value="1.00" />
              </div>

              <div class="field wide">
                <label>Ghi ch√∫ d√≤ng</label>
                <input id="fNote" placeholder="VD: Bao g·ªìm v·∫≠t t∆∞ + thi c√¥ng, b·∫£o h√†nh 12 th√°ng..." />
              </div>
            </div>

            <div class="tableWrap">
              <table>
                <thead>
                  <tr>
                    <th style="width:40px;">#</th>
                    <th>H·∫°ng m·ª•c</th>
                    <th>Nh√≥m</th>
                    <th>Kh·ªëi l∆∞·ª£ng</th>
                    <th>ƒê∆°n gi√°</th>
                    <th>H·ªá s·ªë</th>
                    <th>Th√†nh ti·ªÅn</th>
                    <th>Ghi ch√∫</th>
                    <th style="width:90px;">Thao t√°c</th>
                  </tr>
                </thead>
                <tbody id="tbody">
                  <!-- rows -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <section class="grid2">
          <section class="panel">
            <div class="panelInner">
              <div class="panelHead">
                <div class="left">
                  <b>T·ªïng h·ª£p chi ph√≠</b>
                  <div>Chia theo nh√≥m + VAT + t·∫°m ·ª©ng + c√≤n l·∫°i.</div>
                </div>
              </div>

              <div class="sumGrid">
                <div class="sumCard">
                  <div class="sumTop"><b>V·∫≠t t∆∞</b><span class="tag"><i></i> v·∫≠t t∆∞</span></div>
                  <div class="sumVal" id="sumMaterial">0</div>
                  <div class="sumSub">T·ªïng nh√≥m <b>V·∫≠t t∆∞</b></div>
                </div>

                <div class="sumCard">
                  <div class="sumTop"><b>Nh√¢n c√¥ng</b><span class="tag"><i style="background:rgba(124,58,237,.85)"></i> nh√¢n c√¥ng</span></div>
                  <div class="sumVal" id="sumLabor">0</div>
                  <div class="sumSub">T·ªïng nh√≥m <b>Nh√¢n c√¥ng</b></div>
                </div>

                <div class="sumCard">
                  <div class="sumTop"><b>Thi·∫øt b·ªã + Kh√°c</b><span class="tag"><i style="background:rgba(245,158,11,.90)"></i> ph·ª•</span></div>
                  <div class="sumVal" id="sumOther">0</div>
                  <div class="sumSub">Thi·∫øt b·ªã + c√°c kho·∫£n kh√°c</div>
                </div>

                <div class="sumCard">
                  <div class="sumTop"><b>VAT</b><span class="tag"><i style="background:rgba(16,185,129,.92)"></i> thu·∫ø</span></div>
                  <div class="sumVal" id="sumVAT">0</div>
                  <div class="sumSub"><span id="vatHint">T·∫Øt VAT</span></div>
                </div>

                <div class="sumCard full">
                  <div class="sumTop">
                    <b>T·ªîNG THANH TO√ÅN</b>
                    <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                      <span class="tag"><i style="background:rgba(37,99,235,.85)"></i> t·ªïng</span>
                      <span class="tag"><i style="background:rgba(239,68,68,.85)"></i> c√≤n l·∫°i</span>
                    </div>
                  </div>
                  <div class="sumVal" id="sumGrand">0</div>

                  <div class="sumSub" style="justify-content:space-between;">
                    <div>
                      T·∫°m ·ª©ng:
                      <input id="deposit" type="number" min="0" step="1000" value="0"
                        style="margin-left:8px; width:180px; border-radius:14px; border:1px solid rgba(15,23,42,.10); padding:10px 12px; background: rgba(255,255,255,.82); box-shadow: var(--shadow2); outline:none;">
                    </div>
                    <div>
                      C√≤n l·∫°i:
                      <b id="sumRemain" style="margin-left:8px;">0</b>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section class="panel">
            <div class="panelInner">
              <div class="panelHead">
                <div class="left">
                  <b>Timeline thanh to√°n</b>
                  <div>G·ª£i √Ω k·∫ø ho·∫°ch thu ti·ªÅn theo ti·∫øn ƒë·ªô.</div>
                </div>
              </div>

              <div class="timeline" id="timeline">
                <!-- steps -->
              </div>
            </div>
          </section>
        </section>

      </div>
    </main>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ===== Mobile sidebar =====
    const sidebarBtn = document.getElementById("sidebarBtn");
    const backdrop = document.getElementById("backdrop");
    function closeSidebar(){ document.body.classList.remove("sidebar-open"); }
    function toggleSidebar(){ document.body.classList.toggle("sidebar-open"); }
    if (sidebarBtn) sidebarBtn.addEventListener("click", toggleSidebar);
    if (backdrop) backdrop.addEventListener("click", closeSidebar);
    window.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeSidebar(); });

    // ===== Date =====
    document.getElementById("today").textContent =
      new Date().toLocaleDateString("vi-VN", { weekday:"long", year:"numeric", month:"long", day:"numeric" });

    // ===== Toast =====
    const toastRoot = document.getElementById("toast");
    function toast(title, msg, type="ok"){
      const item = document.createElement("div");
      item.className = "toastItem";
      const dotColor = type==="ok" ? "rgba(16,185,129,.92)" : type==="warn" ? "rgba(245,158,11,.92)" : "rgba(239,68,68,.92)";
      item.innerHTML = `
        <div class="tDot" style="background:${dotColor}; box-shadow:0 0 14px ${dotColor.replace(',.92',',.20')}"></div>
        <div class="tBody">
          <b>${escapeHtml(title)}</b>
          <p>${escapeHtml(msg)}</p>
        </div>
        <button class="tX">ƒê√≥ng</button>
      `;
      item.querySelector(".tX").addEventListener("click", ()=> item.remove());
      toastRoot.appendChild(item);
      setTimeout(()=> item.remove(), 4200);
    }
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
    }

    // ===== Data =====
    let vatOn = false;
    const VAT_RATE = 0.08;

    let rows = []; // {name, group, qty, price, coef, note}

    const tbody = document.getElementById("tbody");
    const searchEl = document.getElementById("search");

    // summary el
    const sumMaterial = document.getElementById("sumMaterial");
    const sumLabor = document.getElementById("sumLabor");
    const sumOther = document.getElementById("sumOther");
    const sumVAT = document.getElementById("sumVAT");
    const sumGrand = document.getElementById("sumGrand");
    const sumRemain = document.getElementById("sumRemain");
    const depositEl = document.getElementById("deposit");
    const vatHint = document.getElementById("vatHint");

    // form el
    const fName = document.getElementById("fName");
    const fGroup = document.getElementById("fGroup");
    const fQty = document.getElementById("fQty");
    const fPrice = document.getElementById("fPrice");
    const fCoef = document.getElementById("fCoef");
    const fNote = document.getElementById("fNote");

    function money(n){
      const v = Math.round(Number(n||0));
      return v.toLocaleString("vi-VN") + " ‚Ç´";
    }

    function lineTotal(r){
      return (Number(r.qty||0) * Number(r.price||0) * Number(r.coef||0));
    }

    function addRow(r){
      rows.push({
        name: r.name || "H·∫°ng m·ª•c",
        group: r.group || "Kh√°c",
        qty: Number(r.qty||0),
        price: Number(r.price||0),
        coef: Number(r.coef||1),
        note: r.note || ""
      });
      render();
      toast("ƒê√£ th√™m d√≤ng", r.name || "H·∫°ng m·ª•c m·ªõi", "ok");
    }

    function removeRow(i){
      const old = rows[i];
      rows.splice(i,1);
      render();
      toast("ƒê√£ x√≥a", old?.name || "1 d√≤ng", "warn");
    }

    function updateRow(i, key, value){
      if (!rows[i]) return;
      rows[i][key] = (key==="qty" || key==="price" || key==="coef") ? Number(value||0) : value;
      recalc();
    }

    function render(){
      renderTable();
      recalc();
      renderTimeline();
    }

    function renderTable(){
      const q = String(searchEl.value||"").toLowerCase().trim();
      tbody.innerHTML = "";

      const filtered = rows.map((r, idx)=> ({...r, __i: idx}))
        .filter(r=>{
          if(!q) return true;
          const hay = (r.name+" "+r.group+" "+r.note).toLowerCase();
          return hay.includes(q);
        });

      if(!filtered.length){
        tbody.innerHTML = `
          <tr>
            <td colspan="9" style="padding:16px; color: rgba(15,23,42,.60);">
              Ch∆∞a c√≥ d·ªØ li·ªáu (ho·∫∑c kh√¥ng kh·ªõp t√¨m ki·∫øm). B·∫•m <b>‚ûï Th√™m d√≤ng</b> ho·∫∑c <b>‚ú® Th√™m m·∫´u</b>.
            </td>
          </tr>
        `;
        return;
      }

      filtered.forEach((r, k)=>{
        const i = r.__i;
        const total = lineTotal(r);

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${k+1}</td>
          <td><b>${escapeHtml(r.name)}</b></td>
          <td><span class="tag"><i></i>${escapeHtml(r.group)}</span></td>
          <td>
            <input value="${r.qty}" type="number" min="0" step="0.01"
              style="width:120px; border-radius:12px; border:1px solid rgba(15,23,42,.10); padding:9px 10px; background: rgba(255,255,255,.85); box-shadow: var(--shadow2); outline:none;"
              data-i="${i}" data-k="qty">
          </td>
          <td>
            <input value="${r.price}" type="number" min="0" step="1000"
              style="width:150px; border-radius:12px; border:1px solid rgba(15,23,42,.10); padding:9px 10px; background: rgba(255,255,255,.85); box-shadow: var(--shadow2); outline:none;"
              data-i="${i}" data-k="price">
          </td>
          <td>
            <input value="${r.coef}" type="number" min="0" step="0.01"
              style="width:100px; border-radius:12px; border:1px solid rgba(15,23,42,.10); padding:9px 10px; background: rgba(255,255,255,.85); box-shadow: var(--shadow2); outline:none;"
              data-i="${i}" data-k="coef">
          </td>
          <td class="money">${money(total)}</td>
          <td style="max-width:280px; overflow:hidden; text-overflow:ellipsis;">
            ${escapeHtml(r.note||"")}
          </td>
          <td>
            <button class="iconBtn" title="X√≥a d√≤ng" data-del="${i}">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      // bind inputs
      tbody.querySelectorAll("input[data-i]").forEach(inp=>{
        inp.addEventListener("input", ()=>{
          updateRow(Number(inp.dataset.i), inp.dataset.k, inp.value);
        });
      });
      // bind delete
      tbody.querySelectorAll("button[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          removeRow(Number(btn.dataset.del));
        });
      });
    }

    function recalc(){
      let material = 0, labor = 0, other = 0;
      for (const r of rows){
        const t = lineTotal(r);
        if (r.group === "V·∫≠t t∆∞") material += t;
        else if (r.group === "Nh√¢n c√¥ng") labor += t;
        else other += t;
      }
      const sub = material + labor + other;
      const vat = vatOn ? sub * VAT_RATE : 0;
      const grand = sub + vat;
      const deposit = Number(depositEl.value||0);
      const remain = Math.max(0, grand - deposit);

      // count-up feel (simple)
      sumMaterial.textContent = money(material);
      sumLabor.textContent = money(labor);
      sumOther.textContent = money(other);
      sumVAT.textContent = money(vat);
      sumGrand.textContent = money(grand);
      sumRemain.textContent = money(remain);

      vatHint.textContent = vatOn ? `ƒêang b·∫≠t VAT ${(VAT_RATE*100).toFixed(0)}%` : "T·∫Øt VAT";
    }

    function renderTimeline(){
      const tl = document.getElementById("timeline");
      const grandText = sumGrand.textContent;
      const grandVal = parseVND(grandText);

      const d1 = Math.round(grandVal * 0.3);
      const d2 = Math.round(grandVal * 0.4);
      const d3 = Math.max(0, grandVal - d1 - d2);

      tl.innerHTML = `
        <div class="step">
          <div class="sDot"></div>
          <div class="sBody">
            <b>ƒê·ª£t 1 ‚Äî T·∫°m ·ª©ng v·∫≠t t∆∞</b>
            <p>Thu tr∆∞·ªõc ƒë·ªÉ ch·ªët v·∫≠t t∆∞/ƒë·∫∑t h√†ng v√† tri·ªÉn khai.</p>
            <div class="meta"><span>üí∏ ${money(d1)}</span><span>‚è± Khi k√Ω th·ªèa thu·∫≠n</span></div>
          </div>
        </div>
        <div class="step">
          <div class="sDot" style="background:rgba(124,58,237,.85); box-shadow:0 0 14px rgba(124,58,237,.18)"></div>
          <div class="sBody">
            <b>ƒê·ª£t 2 ‚Äî Nghi·ªám thu ph·∫ßn</b>
            <p>Thu khi ho√†n th√†nh ~70% kh·ªëi l∆∞·ª£ng ho·∫∑c nghi·ªám thu t·ª´ng ph·∫ßn.</p>
            <div class="meta"><span>üí∏ ${money(d2)}</span><span>üìå Theo ti·∫øn ƒë·ªô</span></div>
          </div>
        </div>
        <div class="step">
          <div class="sDot" style="background:rgba(16,185,129,.92); box-shadow:0 0 14px rgba(16,185,129,.18)"></div>
          <div class="sBody">
            <b>ƒê·ª£t 3 ‚Äî B√†n giao</b>
            <p>Thu ph·∫ßn c√≤n l·∫°i khi b√†n giao/ho√†n c√¥ng.</p>
            <div class="meta"><span>üí∏ ${money(d3)}</span><span>‚úÖ K·∫øt th√∫c</span></div>
          </div>
        </div>
      `;
    }

    function parseVND(s){
      return Number(String(s||"").replace(/[^\d]/g,"")) || 0;
    }

    // ===== Buttons =====
    document.getElementById("btnAdd").addEventListener("click", ()=>{
      addRow({
        name: fName.value || "H·∫°ng m·ª•c m·ªõi",
        group: fGroup.value,
        qty: fQty.value,
        price: fPrice.value,
        coef: fCoef.value,
        note: fNote.value
      });
    });

    document.getElementById("btnRecalc").addEventListener("click", ()=>{
      recalc();
      toast("T√≠nh l·∫°i", "ƒê√£ c·∫≠p nh·∫≠t t·ªïng h·ª£p", "ok");
    });

    document.getElementById("btnToast").addEventListener("click", ()=>{
      toast("UI ƒëang ch·∫°y", "Hover/shine/toast/sort/search ƒë·ªÅu ok.", "ok");
    });

    document.getElementById("btnDemo").addEventListener("click", ()=>{
      addRow({ name:"Tr·∫ßn th·∫°ch cao khung ch√¨m", group:"V·∫≠t t∆∞", qty: 32.5, price: 165000, coef: 1.00, note:"G·ªìm v·∫≠t t∆∞ + ph·ª• ki·ªán c∆° b·∫£n" });
      addRow({ name:"Thi c√¥ng tr·∫ßn th·∫°ch cao", group:"Nh√¢n c√¥ng", qty: 32.5, price: 85000, coef: 1.00, note:"Nh√¢n c√¥ng ho√†n thi·ªán" });
      addRow({ name:"S∆°n b·∫£ ho√†n thi·ªán", group:"Kh√°c", qty: 32.5, price: 65000, coef: 1.10, note:"H·ªá s·ªë 1.10 do b·ªÅ m·∫∑t kh√≥" });
      toast("ƒê√£ th√™m m·∫´u", "3 h·∫°ng m·ª•c demo", "ok");
    });

    document.getElementById("btnClear").addEventListener("click", ()=>{
      rows = [];
      render();
      toast("ƒê√£ reset", "B·∫£ng tr·ªëng", "warn");
    });

    document.getElementById("btnVAT").addEventListener("click", ()=>{
      vatOn = !vatOn;
      recalc();
      toast("VAT", vatOn ? "ƒê√£ b·∫≠t VAT" : "ƒê√£ t·∫Øt VAT", "ok");
    });

    document.getElementById("btnDeposit").addEventListener("click", ()=>{
      const cur = Number(depositEl.value||0);
      const grand = parseVND(sumGrand.textContent);
      const suggest = Math.round(grand * 0.3);
      depositEl.value = String(Math.max(cur, suggest));
      recalc();
      toast("T·∫°m ·ª©ng", "ƒê√£ set t·∫°m ·ª©ng g·ª£i √Ω ~30%", "ok");
    });

    depositEl.addEventListener("input", recalc);

    searchEl.addEventListener("input", ()=>{
      renderTable();
    });

    // Export JSON
    document.getElementById("btnExport").addEventListener("click", ()=>{
      const payload = {
        project: {
          name: document.getElementById("pjName").textContent,
          client: document.getElementById("pjClient").textContent,
          address: document.getElementById("pjAddr").textContent,
          note: document.getElementById("note").value || ""
        },
        vatOn,
        vatRate: VAT_RATE,
        deposit: Number(depositEl.value||0),
        rows,
        totals: {
          material: parseVND(sumMaterial.textContent),
          labor: parseVND(sumLabor.textContent),
          other: parseVND(sumOther.textContent),
          vat: parseVND(sumVAT.textContent),
          grand: parseVND(sumGrand.textContent),
          remain: parseVND(sumRemain.textContent)
        }
      };

      const blob = new Blob([JSON.stringify(payload, null, 2)], { type:"application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "du-toan-thi-cong.json";
      a.click();
      URL.revokeObjectURL(a.href);
      toast("Export JSON", "ƒê√£ t·∫£i file du-toan-thi-cong.json", "ok");
    });

    // Print
    document.getElementById("btnPrint").addEventListener("click", ()=>{
      toast("In / PDF", "ƒêang m·ªü ch·∫ø ƒë·ªô in‚Ä¶", "ok");
      setTimeout(()=> window.print(), 300);
    });

    // ===== initial =====
    function init(){
      render();
      toast("S·∫µn s√†ng", "B·∫°n c√≥ th·ªÉ th√™m d√≤ng ho·∫∑c b·∫•m ‚ÄúTh√™m m·∫´u‚Äù.", "ok");

      // progress fake
      const pct = 55;
      document.getElementById("barPct").textContent = pct + "%";
      document.getElementById("barFill").style.width = pct + "%";
    }
    init();
  </script>
</body>
</html>
